******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

AppsからInternal Server Errorが14回帰ってきていました。
いつもよりかは多いなという感覚です。

それと特に以下のユーザのコンタクトリストマスタの処理でリトライが多発し
ていました。
　01-93@ajis-group.com
最終的にリトライを重ねて同期は終わっていました。

取り急ぎのご報告でした。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

開発したシステムで、ユーザの評判がよく利便性が向上したいう嬉しい状況
になったことは、開発に関わる者にとっての何よりの結果です。

いろいろご迷惑をおかけしましたが、いいものを納品することがき
大変嬉しく思います。
ありがとうございます。

引き続きよろしくお願いします。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

先ほどのメールにドキュメントを添付してありますので、そちらを
参照して頂けますでしょうか？

よろしくお願いします。

******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

大変遅くなってしまいましたが、エラーメール送信対象のエラーメッセージ一覧
の資料を送付致します。


ご確認ください。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

zoosso にてTomcatの確認を行いましたが、正常に動作しています。
そとからの通信に問題があるようです。

ご確認ください。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

PDFの、7b-8bはログイン時に発生します。

繋吉のログを確認したところ、LDAP Proxyと通信ができない状態になっている
ようです。
どうも外からの通信ができていないように見受けられます。

zoosso にログインしてTomcatが上がっているか確認しようとしましたが、すで
にリモートでログインしているようですので、いったんログアウトして頂けま
すでしょうか？

以上、よろしくお願いします。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

> 他社様は、コンタクトリストマスタを使用する際に「同期中でない」ことをど
> のように確認しているのでしょうか？
> 
> 私は、自分自身が行っている「RDPでAD同期サーバにログインして、タスクスケ
> ジューラで同期タスクの状態をチェックする」という方法以外に思いつきませ
> ん。

同期中かどうかは、加藤様がおっしゃる通りの方法しかありません。

以上、よろしくお願いします。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。


> 1)
> 同期実行中に、contactlistmasterを更新するとどのような挙動となりますか？

そもそも想定をしていませんので、想定外の動作をする、としか回答できません。
更新をしないようにして頂くのが原則となります。


> 2)
> 誤って他のテーブルをクリアもしくは削除してしまった場合、どのようなリカバリ策が取れますか？

連絡帳同期バッチは、ADの情報を正にして動作することが前提です。
仮にテーブルのデータがなくなったとしても、再度ADの情報を取り込めばテーブルの
データとしてはそれで復旧し動作します。
（コンタクトリストマスタは別途バックアップをしておいて頂く必要はあります。）

ですので、一旦全テーブルをクリアして同期するのがリカバリ策となります。

その際は新規扱いになり、更新量が増えますので同期時間が長くなりますが、同期
としては問題なく動作するはずです。

このことから、DBのデータバックアップ等は考慮していません。

唯一運用リカバリが必要な点として、仮にユーザマスタ(usermaster)がクリアされた
場合、削除猶予期間の情報がなくなってしまいます。
管理コンソールにて手でで削除して頂くか、猶予期間を持つレコードを手で作成
するかのリカバリが必要になります。

以上、よろしくお願いします。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

ログを確認しました。
削除にいっているのは以下のuserdnのレコードでした。

　CN=インフラ テスト用,CN=Users,DC=AJIS,DC=local

恐らくメールアドレスはtest.infra@ajis-group.comだったのではないでしょうか？

削除されたのは、削除猶予期間(30日)を過ぎたと判断されたためだと思われます。


以上、よろしくお願いします。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

リリース作業が完了しました。

以上、よろしくお願いします。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

> 念のためご確認です。
> 上記は、２パターンの動きがあると思います。
> それぞれ、どのような動きとなりますか？
> 
> 1)メールアドレスが以前と同じ（すなわち、休止復活)
> 2)メールアドレスが以前と違う

（１）は、停止中アカウントが復活します。

（２）は新しくアカウントが作成されます。

以上、よろしくお願いします。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

表記の件の改修が完了しました。

変更点は以下です。
　削除済になっているレコードと同一のuserdnを持つアカウントが
　作成された場合、新規作成の扱いで処理する。

注意点としては、古いメールアドレスのアカウントレコードが保持でき
なくなりますので、削除猶予期間を過ぎても古いメールアドレスの
Appsアカウントは削除されないままとなります。

こちらは手運用にて削除してください。


問題なければリリース致します。

以上、よろしくお願いします。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

本番DBに新しくdatabaseを作成しました。

database: ajistest

ユーザ、パスワードは今お使いのgoogle_ssoでお願いします。

接続する際に database を ajistest にする以外の設定項目に
変更はありません。

ご確認ください。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

> ＞また昨日のお電話でもお話した、本番のDBにもうひとつdatebaseを作成する
> ＞ことも可能です。
> 
> 先々の事を考えますと、上記対応を頂いたほうが有用と考えますのでこちらでお願いいたします。

かしこまりました。

では、本番のDBにdatabaseを作成します。
新しく作ったdatabaseには、一旦 contactlistmaster テーブルのみ作成致します。
他のテーブルはユーザの編集対象ではないため作成してもあまり意味はないかと
考えます。 

よろしいでしょうか？




******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

ツールの検証の件、了解致しました。

CSVをこちらに送って頂いて、化けないか確認をすることは問題ありません。

また昨日のお電話でもお話した、本番のDBにもうひとつdatebaseを作成する
ことも可能です。

どちらの対応がよろしいでしょうか？

以上、よろしくお願いします。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

バッチの切り戻し作業が完了致しました。
引き続き対応を進めます。

ご迷惑をおかけし申し訳ございません。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

予定より少し早いですが、バッチのリリース作業が完了致しました。

以上、よろしくお願いします。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

コンタクトリストマスタの改修が完了致しました。
ご提供頂いたデータでのテストも問題はありませんでした。

ただいま、リリース準備の段階です。
予定通り月曜日にリリースが可能です。

朝一にリリースを予定しています。
リリース作業には１時間程お時間を頂きます。
リリースの際、contactlistmasterテーブルの再作成が必要になりますので
データはすべて消去されますことを予めご了承下さい。

以上、よろしくお願いします。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

修正したCSVにて、新テーブルにエラーなくimportができました。

以上、よろしくお願いします。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

もう一点、データを確認していて気づいた点がございました。
contactlistmaster_fcadd.csv の「エイジス 台湾」のグループの
中の幾人かの名前が化けて？になっています。

おそらく、ファイルの文字コードがいわゆるMS932で、その文字コードで
表現できない文字が保存時に化けたのではないかと推測致します。

ご確認ください。

以上、よろしくお願いします。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

データの確認を致しました。

仕様変更に伴い、コンタクトリストマスタの定義を変更しています。
メールアドレスと電話番号でユニークなるようにしました。

この新しいコンタクトリストマスタテーブルに対してimportをしてみたとこと
以下のファイルで重複登録があるようです。

数件確認しましたが、メールアドレスのみあって、２つのグループに属すように
登録されているようです。
これでメールアドレスが重複してインポートエラーとなっているようです。

以下、インポートのログをつけます。

よろしくお願いします。


インポート元>	S:\90_Work\kawano\contactlistmaster_CSV\contactlistmaster_fcadd.csv

表情報を取得中です...
表情報の取得が完了しました。

レコードをINSERT中です...
100件の処理が完了...

142件目を処理中に以下のエラーが発生しました。
ｴﾗｰｺｰﾄﾞ：1062  [MySQL][ODBC 5.1 Driver][mysqld-5.1.69-0ubuntu0.11.10.1]Duplicate entry 'ystanaka@ajisk.co.jp' for key 'mobileNumber'
SQLｽﾃｰﾀｽ：23000
143件目を処理中に以下のエラーが発生しました。
ｴﾗｰｺｰﾄﾞ：1062  [MySQL][ODBC 5.1 Driver][mysqld-5.1.69-0ubuntu0.11.10.1]Duplicate entry 'rbeppu@ajisk.co.jp' for key 'mobileNumber'
SQLｽﾃｰﾀｽ：23000
151件目を処理中に以下のエラーが発生しました。
ｴﾗｰｺｰﾄﾞ：1062  [MySQL][ODBC 5.1 Driver][mysqld-5.1.69-0ubuntu0.11.10.1]Duplicate entry 'tishida@ajisk.co.jp' for key 'mobileNumber'
SQLｽﾃｰﾀｽ：23000
152件目を処理中に以下のエラーが発生しました。
ｴﾗｰｺｰﾄﾞ：1062  [MySQL][ODBC 5.1 Driver][mysqld-5.1.69-0ubuntu0.11.10.1]Duplicate entry 'tnouzaki@ajisk.co.jp' for key 'mobileNumber'
SQLｽﾃｰﾀｽ：23000
174件目を処理中に以下のエラーが発生しました。
ｴﾗｰｺｰﾄﾞ：1062  [MySQL][ODBC 5.1 Driver][mysqld-5.1.69-0ubuntu0.11.10.1]Duplicate entry '080-5248-7103-syamamoto@ajisk.co.jp' for key 'mobileNumber'
SQLｽﾃｰﾀｽ：23000
197件目を処理中に以下のエラーが発生しました。
ｴﾗｰｺｰﾄﾞ：1062  [MySQL][ODBC 5.1 Driver][mysqld-5.1.69-0ubuntu0.11.10.1]Duplicate entry 'haibe@ajisk.co.jp' for key 'mobileNumber'
SQLｽﾃｰﾀｽ：23000
200件の処理が完了...

202件目を処理中に以下のエラーが発生しました。
ｴﾗｰｺｰﾄﾞ：1062  [MySQL][ODBC 5.1 Driver][mysqld-5.1.69-0ubuntu0.11.10.1]Duplicate entry 'karima@ajisk.co.jp' for key 'mobileNumber'
SQLｽﾃｰﾀｽ：23000
214件目を処理中に以下のエラーが発生しました。
ｴﾗｰｺｰﾄﾞ：1062  [MySQL][ODBC 5.1 Driver][mysqld-5.1.69-0ubuntu0.11.10.1]Duplicate entry 'kmurakami@ajisk.co.jp' for key 'mobileNumber'
SQLｽﾃｰﾀｽ：23000
230件目を処理中に以下のエラーが発生しました。
ｴﾗｰｺｰﾄﾞ：1062  [MySQL][ODBC 5.1 Driver][mysqld-5.1.69-0ubuntu0.11.10.1]Duplicate entry 'kenmatsumoto@ajisk.co.jp' for key 'mobileNumber'
SQLｽﾃｰﾀｽ：23000
231件目を処理中に以下のエラーが発生しました。
ｴﾗｰｺｰﾄﾞ：1062  [MySQL][ODBC 5.1 Driver][mysqld-5.1.69-0ubuntu0.11.10.1]Duplicate entry 'tstanaka@ajisk.co.jp' for key 'mobileNumber'
SQLｽﾃｰﾀｽ：23000
258件目を処理中に以下のエラーが発生しました。
ｴﾗｰｺｰﾄﾞ：1062  [MySQL][ODBC 5.1 Driver][mysqld-5.1.69-0ubuntu0.11.10.1]Duplicate entry 'ys.saito@ajisk.co.jp' for key 'mobileNumber'
SQLｽﾃｰﾀｽ：23000
300件の処理が完了...

レコードのINSERT処理が完了しました。
総件数は382件です

インポート処理が完了しましたがエラーが発生しています。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

データの提供、ありがとうございます。
大変助かります。

確認致します。

以上、よろしくお願いします。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

リリースが完了しました。

以上、よろしくお願いします。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

弊社でもカスタムフィールドを作成して検証したところ、再現致しました。
お電話での調整通り、改修をし、完了致しました。

リリースをさせて頂けますでしょうか？

以上、よろしくお願いします。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

お電話で調整した通り、本件改修致します。

またDBからのレコード削除を致しました。

以上、よろしくお願いします。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

ADで削除した後の同期で削除処理は動いていました。
削除処理をしても、DBには猶予期間がすぎるまではレコードとして
存在しています。

今回、userdnを変更せずに同じuserdnで追加となっていますので
結果としてメールアドレスが変更されていると判断になっています。

userdnを変えて追加すると回避できます。
それでご対応頂けますでしょうか？

よろしくお願いします。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

昨夜のお電話で調整した、スレッド数を30に変更する件です。
あの後同期されていたので変更はしていませんでした。

先ほど、30に変更しておきました。

以上、よろしくお願いします。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

かしこまりました。
では、同期終了後に、45に設定変更します。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

状況確認致します。

例外エラーは、コンタクトリストマスタ関係だと思われます。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

なるほど。
経緯がわかりました。

解消手順は、おっしゃる通りで行うのが確実です。

以上、よろしくお願いします。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

5/9 21:00の同期で新規登録となっています。
その際のメールアドレス、whenChangedが以下です。
　mochizuki.takashi@ajis-group.com
　20130509075120

これでAppsは登録されています。

その後おそらくADの変更が行われたものと思われます。
そして、5/10 21:00の同期でメールアドレスが変更されているエラーになります。
その際のCSVに出力されている内容が以下です。
　takashi.mochizuki@ajis-group.com
　20130510055512

この際、このCSVのデータはスキップされますので、DBは5/9時点のものが残る
ことになります。

以上、よろしくお願いします。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

コンタクトリストマスタの削除エントリが決まる条件について回答致します。

1.削除対象のレコードにメールアドレスがあった場合は、
　そのメールアドレスが一致※するものを削除。
2.削除対象のレコードにメールアドレスがなかった場合は、
　携帯番号が一致※したものを削除。

※メールアドレス、携帯番号での一致を試みるのは内部でキャッシュでもっている
　連絡先エントリで最初に見つかったもの。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

不具合(4)：コンタクトリストマスタの登録でグループラベルが複数される
問題に対処したプログラムのリリース作業が完了しました。

よろしくお願いします。


------------------------------------------------------------


update usermaster set mail = replace(mail,'@ajis-group.com','@kensyou06.yoshidumi.co.jp')


------------------------------------------------------------


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

3時間ほど間隔が空いていれば問題ないと思います。

よろしくお願いします。


------------------------------------------------------------

[Tt]estkawamata.[Tt]est

ユーザー yutaka.kayamoto@ajis-group.com をグループ 11f4@ajis-group.com に追加しました
ユーザー norio.ishibashi@ajis-group.com をグループ 1211@ajis-group.com に追加しました
ユーザー junki.sato@ajis-group.com をグループ 1211@ajis-group.com に追加しました
ユーザー kaori.sakaguchi@ajis-group.com をグループ 12z6@ajis-group.com に追加しました
ユーザー seiichiro.yarita@ajis-group.com をグループ asc_info@ajis-group.com に追加しました
ユーザー junki.sato@ajis-group.com をグループ asc_info@ajis-group.com に追加しました
ユーザー takeshi.kitano@ajis-group.com をグループ 11g5@ajis-group.com に追加しました
ユーザー mineaki.kumazawa@ajis-group.com をグループ 11g5@ajis-group.com に追加しました

[Yy]utaka.[Kk]ayamoto
[Nn]orio.[Ii]shibashi
[Jj]unki.[Ss]ato
[Kk]aori.[Ss]akaguchi
[Ss]eiichiro.[Yy]arita
[Jj]unki.[Ss]ato
[Tt]akeshi.[Kk]itano
[Mm]ineaki.[Kk]umazawa

******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

かしこまりました。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

プログラムリリース作業が完了しました。

以上、よろしくお願いします。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

> ＞1) 原因が判明し、対処中です。
> ＞　現在テスト中で、完了予定が明日(5/4)となっております。
> 
> こちらの内容ですが、原因について疑問があります。
> 更新判定のアルゴリズムにバグが潜んでいるのであれば、kensyou03での検証時、および4/16の情シス先行リリース時に同様の結果が出ると思うのです。
> しかしながら、本現象が発生しているのは4/23の本番モードリリース後にアドレス帳同期の対象となったユーザのみです。
> 
> 今一度、原因について再考いただきたく。

検証03の際には、いわゆる入れ子になっているグループでもDBが初期の状態で
同期開始しているので、グループメンバーの登録はされます。

検証の際に、グループの中のグループでかつ順番が入れ子になっている検証は
行った記憶はありません。

また、仮に検証したとしても、削除したり追加したりしないと明確な動作結果を
確認できないので、判別しにくく見落としていた可能性も高いです。

本番モードの際は、DBのクリアは行われていないため、アドレス帳同期としては
入れ子になったグループメンバーに対しての更新を認識していないために更新され
なかったので、事象発生が23日以降同期対象となったユーザのみとなります。


> ＞6) 原因が判明し、プログラム改修も完了し、テストも完了しました。
> 
> こちらの内容については了解しました。
> 無効化されたアカウントの次のアカウントのみが不具合の対象となるから、発生したりしなかったりといった現象として出る、ということですね。

はい。そうです。


> ただ、4/28・4/30・5/1と繰り返し削除が行われたのは、本原因によるものですか？
> その点が頂いているご回答からは不明瞭です。
> 処理漏れが原因なのであれば、事象の発生は翌日の１回だけなのではないか？という気がします。

事象が発生（つまり誤判断で削除となった）した28日はそのまま削除処理されます。
レコードもなくなります。

29日は、ユーザ・グループメンバーは正しく登録された状態になっていますので、レコード的には
グループメンバーの追加扱いになります。
ただグループのメンバー追加としての判断はされない（本事象では比較処理がされない)ため、
グループへのメンバー追加は行われません。
そのかわり、連絡先には追加が行われています。

30日は29日のメンバーレコードがありますので削除と誤判断します。
これでグループからの削除が走り、連絡先からも削除となります。
ただ、連絡先処理中に例外が起きたため、レコードは削除のまま残ります。

5/1は全更新の同期ですが、ここでも削除と誤判断します。30日のレコードが残っているからです。
これでグループからの削除が走り、連絡先からも削除となります。
この日は例外が起きなかったので、レコードも削除されます。

5/2はレコードなしのところで判断対象外になり、内部的に追加となるので
連絡帳の追加が行われます。（グループメンバー追加はしていない）

5/3は削除の誤判定です。
グループメンバーの削除を試みているログはあります。
監査ログにものるかと思います。
(5/1に運用リカバリでメンバー追加した状態なので)


以上、よろしくお願いします。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

該当のエラーは、ユーザの連絡帳更新でリトライを繰り返し、その繰り返し
上限に達したため発生したものでした。

ログを確認したところ、AppsからInternal error(いわゆる500)が帰って
きていました。

その後の再処理で処理は完了しております。

以上です。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

不具合について一時回答致します。
管理表を更新しました。
※更新の仕方が間違っているかもしれません。その際はご容赦願います。

以下、簡単にご報告致します。

1) 原因が判明し、対処中です。
　現在テスト中で、完了予定が明日(5/4)となっております。

2) 保留中

3) プログラム改修の方向性が決まりました。
　改修日程の調整中です。

4) プログラム改修の方向性が決まりました。
　改修日程の調整中です。

5) 内部調整中です。

6) 原因が判明し、プログラム改修も完了し、テストも完了しました。


以上、よろしくお願い致します。


------------------------------------------------------------

1171:,AJIS 情報システム部 に 117c：AJIS 情シス社員　がない

グループは更新と判断
AJIS AISﾁｰﾑ : 1179@ajis-group.com に 1176：AJIS AIS SW開発G がない


grep "[Jj]unichi.[Mm]atsumoto"

[Yy]asutaka.[Ii]moto
grep "[Tt]akeshi.[Kk]itano"

shigenobu.hanai
grep "[Mm]ineaki.[Kk]umazawa"

kawano@kawano-desktop:~/projects/ajis$ grep "[Ss]higenobu.[Hh]anai" 201304??_sync/batch.log | less
kawano@kawano-desktop:~/projects/ajis$ grep "[Tt]akeshi.[Kk]itano" 201304??_sync/batch.log | less



ユーザー takeshi.kitano@ajis-group.com をグループ 11g5@ajis-group.com から削除しました
ユーザー mineaki.kumazawa@ajis-group.com をグループ 11g5@ajis-group.com から削除しました


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

削除されたアカウントですが、すべて whenChanged が 4/2 になっており、また
すべてアカウントが無効化されています。

アカウントが無効化されてから30日経過したアカウントは削除の対象となります。
それで削除されました。

以上、よろしくお願いします。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

コンタクトリストマスタのデータを確認致しました。

このファイルの7行目から10行目までのレコードに、携帯電話番号が入っていませんでした。

おそらく、このCSVファイルをCSEを使ってcontactlistmasterテーブルに
インポートされたと推測致しますが、その際にエラーが発生していたはずです。

上記操作をした場合、7行目はインポートされますが、8,9,10行目がエラーで
取り込みができない結果になります。

結果として7行目の削除処理は4/23に動作致しますが、8,9,10行目は取り込まれていないので
処理がなされていません。

データの修正をお願い致します。
（携帯電話は必須項目のキーとなりますので省略は不可です）


なお、頂いたデータで検証環境に同期したところ、23日のようなエラーは再現
しませんでした。
ただラベルが複数作成される問題は再現致しましたので、引き続き対応致します。

以上です。

******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

弊社の検証環境では、最大で10アカウントまでなので、スレッド数を増やしても
最大で10アカウントまでしか同時に処理をしないため、上限の確認にはならないのです。

15へ変更することに関しての問題があるかないかの見通しは、正直に言いますと
ありません。

他実績では、15はあるようです。

先ほど、本番環境のスレッド数を15に変更しました。

以上、よろしくお願いします。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

> 表題：「[繁吉SLP]端末登録が申請されました」のメールは、今回登録されたアドレス全てに送信されるという理解で正しいですか？

はい。
管理者全員あてにメールが送信されます。

以上、よろしくお願いします。




******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

＜対象アカウント＞
sso.shibatsuji@kensyou03.yoshidumi.co.jp
sso.onoda@kensyou03.yoshidumi.co.jp
sso.kageyama@kensyou03.yoshidumi.co.jp
sso.kato@kensyou03.yoshidumi.co.jp
sso.kawamata@kensyou03.yoshidumi.co.jp

に対して、繁吉ヘルプと繁吉管理者画面の登録が完了しました。

ご確認ください。







******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

12時のバッチ実行についてです。
15時の段階で296件目の処理をしています。

このペースでいきますと、終了予測時間は19時半以降となります。

ざっと、ログを確認したところ、リトライをしていたりはしておらず
1件当たり大体6分くらいのペースで処理をしています。


取り急ぎのご連絡となります。







******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

同期が終了しました。

終了時間は17:36です。
15時台のコンタクトリストマスタのエラー通知以外のエラーは
発生していません。

以上、よろしくお願い致します。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

有識者に確認しました。

候補は以下から取得しています。
・連絡先エントリー
・グループに含まれるエントリー
・Appsで公開している連絡先

これらが一緒に表示されます。

どのようなロジックでもってきて表示しているかは非公開の情報となっております。

また、ご希望の下段側を表示させない、ということは設定などではできません。
（このあたりはミステリアスな動きの部分のようです）

以上、よろしくお願い致します。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

昨夜のバッチ実行結果を確認致しました。
コンタクトリストマスタの登録時エラーはひき続き発生していますが、他の
エラーは発生していませんでした。

先ほど確認した段階では、574件目の処理を始めています。

終了予定時間はあまり変更はなく、18時頃となっています。


お問い合わせ頂いてる件に回答致します。

> ＞> ・次回同期で再登録実行されますか？
> ＞ですので、終わってからとはなりますが、結果を確認の上、初期投入時と
> ＞同じ内容を再度登録し直してからの同期をすることになります。
> 
> 上記了解しました。
> 正常終了したユーザへの登録はスキップされ、失敗したユーザへの登録が実行されるという理解で正しいですか？

いいえ。
コンタクトリストマスタの処理結果を個別に残していませんので、全ユーザを
対象として、コンタクトリストマスタの初期投入時データを再同期することになります。


> ＞成功・失敗を簡単に把握する方法は、現在ございません。
> ＞ログからまとめる必要があります。
> 
> 了解しました。
> 「成功・失敗」それぞれをまとめるためのキーワードをお教えください。

申し訳ございませんが、それぞれを抽出するキーワードがログに出力されて
おりません。

手順としては、
　・スレッドごとにログを抽出。
　・処理開始時点をみつけ（キーワードあり）、その後メールで通知されているERRORが
　　発生せずに次の処理を開始しているかを確認。

となります。


> ＞エラーメールの内容に、処理対象ユーザ情報を追加することは可能ですので
> ＞それで失敗したアカウントは把握できるようにはなります。
> 
> 改修後対応、という事ですか？

はい。
そのとおりです。


以上、よろしくお願い致します。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

> ＞考えられるのは、AppsへのAPI発行時と、プログラム的な問題ですが、
> ＞コンタクトリストマスタの処理が成功しているユーザもおりますので、
> ＞おそらくAPI側だろうと推察します。
> ＞こちらについても、ログ出力を追加する形で対応を取らせて頂ければと
> ＞思います。
> 
> 了解しました。
> エラー内容が「コンタクトリストマスタの登録失敗」ですので、以下確認です。
> 
> ・次回同期で再登録実行されますか？

はっきり申し上げられなくて恐縮ではございますが、再登録にはならない仕様のようです。

全ユーザの連絡帳同期が終了したあとに、処理結果をDBに残す処理が実行
されますが、その段階で恐らく「処理済み」に更新されるはずです。

ですので、終わってからとはなりますが、結果を確認の上、初期投入時と
同じ内容を再度登録し直してからの同期をすることになります。


> ・今回のような事象は、他社では発生していないのでしょうか？

発生しているようです。
ですが、件数がこれほど多くはなかったようで、ネットワーク的な問題で発生
したものとみなしたようです。


> ＞11:14から連絡帳の処理を開始し、18:30の段階で176件目の処理をしていました。
> 
> 176件の処理内訳には、「完全に登録が成功した人」と「例外処理が発生した人」が混在していると思います。
> 処理終了したユーザの成功者と失敗者がわかる方法はございませんか？
> 今後のサポート情報として捉えておきたく。

おっしゃる通り、混在している数字です。

成功・失敗を簡単に把握する方法は、現在ございません。
ログからまとめる必要があります。

エラーメールの内容に、処理対象ユーザ情報を追加することは可能ですので
それで失敗したアカウントは把握できるようにはなります。


> ＞この数字から計算すると、約31時間かかる計算になります。
> ＞終了予定時刻は明日の18時半頃の見込みとなります。
> 
> 当初予定の４倍ですか・・・。
> 致し方ないですね。

申し訳ございません。


> ＞ログを見てみると、リトライがかかっているのが見受けられます。
> ＞これが処理に時間がかかっている原因のひとつです。
> 
> リトライとは、エラーリトライですか？
> ADに登録されている情報の登録ではエラーは発生していないようですので、なぜコンタクトリストマスタの登録に失敗するのか不思議です。

Appsへ更新にいった際に、Versionが違うという類の例外が帰って来ることがあります。
これが起きたときには、バッチは最新のものを取得してから処理をやり直すようになっています。

ご指摘の通り、なぜコンタクトリストマスタの処理だけ失敗するのか、継続して解析を
しているのですが、情報不足もあり明確な回答ができない状況です。


以上、よろしくお願い致します。
 


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

バッチの終了予測時間を算出しました。

11:14から連絡帳の処理を開始し、18:30の段階で176件目の処理をしていました。
時間あたり、約24件処理していることになります。

この数字から計算すると、約31時間かかる計算になります。
終了予定時刻は明日の18時半頃の見込みとなります。

ログを見てみると、リトライがかかっているのが見受けられます。
これが処理に時間がかかっている原因のひとつです。


取り急ぎのご連絡でした。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

アラートメールの件です。

お電話でも簡単にお伝えしましたが、コンタクトリストマスタの処理中で
エラーになっています。

EHNS5039は、コンタクトリストマスタの内容を追加処理する際に発生した
場合のエラーになります。

ただ、ログ出力が不足しており、エラーに至った詳細な原因を把握することが困難な状態です。
類似点や規則性などもないか解析致しましたがこれといった点が断定できませんでした。

考えられるのは、AppsへのAPI発行時と、プログラム的な問題ですが、
コンタクトリストマスタの処理が成功しているユーザもおりますので、
おそらくAPI側だろうと推察します。


こちらについても、ログ出力を追加する形で対応を取らせて頂ければと
思います。

ご迷惑をおかけいたしますが、よろしくお願い致します。




******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。


バッチの本番モードへの設定変更が完了致しました。

以上です。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

20時の同期で、再現した件です。

CSVには問題がありませんでした。

弊社の環境で16時のものと20時のものを使って、再現テストもしてみましたが再現せず、
原因が特定できていません。


そこで、バッチにデバッグログを追加して情報を更に収集する対応を取りたいと
考えています。

デバッグログの追加改修に少々お時間を頂きたく、明日早い段階で本番へ反映できる
予定でおります。


明日の作業との兼ね合いもありますので、明日朝出社後お電話致します。

よろしくお願い致します。




******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

お問い合わせ頂いてるトラブルについてです。

先ほどお電話で調整させて頂きました通り、バッチファイルで
CSVファイルをバックアップする修正を行いました。

本番zoodcsyncにも反映済みです。

20時の同期からファイルがバックアップされます。

再現するかも含め、様子をみさせてください。
よろしくお願い致します。




******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

順調に検証が進んでいるとのこと、安心致しました。


> 　2)端末登録申請フォームページ
> 　　ヘルプには以下のように記載されておりますが、
> 　　https://tsuna-yoshi.appspot.com/slp/stickyId-external?domain=yourdomain.com
> 　　　（「yourdomain.com」部分はログイン対象のドメイン名となります）
> 
> 　　以下にて利用できました。
> 　　https://tyoshi-staging.appspot.com/slp/apply-login?domain=kensyou03.yoshidumi.co.jp
> 
> 　　本番時にはtsuna-yoshi.appspot.comでの利用となりますか？

ご説明が不足しておりました。
申し訳ございません。

検証期間中は、ヘルプ内の繋吉のURLは、tsuna-yoshiをtyoshi-stagingに
読み替えて頂けますでしょうか？

本番時はおっしゃる通り、tsuna-yoshi.appspot.com となります。


以上、よろしくお願いします。


******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

すみません。
間違えた回答をしてしまいました。

> > ※
> > つまり、SSOを利用可能なユーザは基本、tsunayoshi-userに登録されたユーザ。
> > tsunayoshi-userに登録されていないユーザでも繁吉管理者画面で繁吉IDを直接登録すれば、SSO画面を介してGoogleAppsにログオン可。(当然、Appsにアカウントが必要)
> 
> はい。
> おっしゃる通りです。
> 繋吉管理画面で繋吉IDを登録すると、Appsのアカウントを作りにいきます。
> 結果的に、SSO経由でAppsにログオンが可能となります。

上記の回答が間違えです。

繋吉管理画面で繋吉IDを登録します。
Appsのアカウントはこの状態では作られません。

AppsのアカウントをAppsで作成して頂く方法と、もうひとつは同期するボタンを
押下することでAppsと同期をします。

以上、よろしくお願いします。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

> ＞・ユーザ作成は、本番zoodcsync上の繋吉ユーザ同期バッチにより
> ＞　本番ADより情報を抽出し、検証環境に向けて行いました。
> ＞・作成されたユーザは検証環境のドメインをメールアドレスにもつ6件です。
> ＞　他はエラーで無視されています。
> 
> 上記は、「繁吉IDの登録は自動同期で自動登録されました」との理解で正しいですか？

正確には、「繁吉IDの登録は手動同期で自動登録されました」となります。


> ※
> つまり、SSOを利用可能なユーザは基本、tsunayoshi-userに登録されたユーザ。
> tsunayoshi-userに登録されていないユーザでも繁吉管理者画面で繁吉IDを直接登録すれば、SSO画面を介してGoogleAppsにログオン可。(当然、Appsにアカウントが必要)

はい。
おっしゃる通りです。
繋吉管理画面で繋吉IDを登録すると、Appsのアカウントを作りにいきます。
結果的に、SSO経由でAppsにログオンが可能となります。

以上、よろしくお願いします。



******************** メ ー ル 下 書 き ********************
株式会社エイジス
加藤様：

お世話になっております。吉積情報の川野です。

> 1.IP制限
> まずは社外からのApps利用を制限するため、社内LANからのみ利用可に設定します。
> そのためIP制限をかけますが、ヘルプに「添付のipremote.txtにログインを許可するIPアドレスを設定し」と書かれています。
> ipremote.txtなるファイルをお送りいただけますか。
> https://sites.google.com/a/tsuna-yoshi.com/tsuna-yoshi/home/tsunayoshi_slp_main/kanri_menu/access/remoteip_001

ファイルは、同じ管理画面からダウンロード可能です。
そちらをご利用ください。


> 2.端末登録
> 社外からAppsを利用するユーザには端末登録を行わせて許可する予定です。
> 申請フォームページからのPC端末の登録を行ってみたいのですが、繁吉ユーザヘルプを見ることができません。
> ※管理者ヘルプは見れます。
> 許可設定していただけますか。

ユーザメニューの文言が古かったようです。
ユーザ側のヘルプは以下となります。 
https://sites.google.com/a/tsuna-yoshi.com/tsuna-yoshi/home/tsunayoshi_slp_main/user_menu/add_sticky_001

こちらの内容でで検証をすすめることができますでしょうか？

以上、よろしくお願いします。

